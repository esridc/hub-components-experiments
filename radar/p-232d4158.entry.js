import{r as t,c as e,h as i,H as s}from"./p-d703c309.js";import{r as a}from"./p-0050330c.js";import{m as o,f as r}from"./p-9a3108ff.js";import{U as n}from"./p-82285f77.js";import{r as l,c,_ as h}from"./p-ae8fd155.js";import{a as d}from"./p-a8ccf5d0.js";import"./p-8dae81d7.js";import"./p-6343e8b1.js";import"./p-6bdf64e1.js";import"./p-834ef0aa.js";import"./p-46d9ff3a.js";import"./p-90bbd14a.js";import"./p-797f9b51.js";import"./p-7c13aa15.js";import"./p-4b2e8de5.js";import"./p-fae24807.js";let m=class{constructor(i){t(this,i),this.eventDeleteAnnotation=e(this,"eventDeleteAnnotation",7),this.allowReply=!0,this.allowEdit=!1,this.allowDelete=!1}deleteAnnotation(t){t.preventDefault(),this.eventDeleteAnnotation.emit(this.annotationId)}render(){return i(s,null,i("slot",null),i("div",{class:"comment",id:this.annotationId},i("div",{class:"avatar"},this.authorImage?i("img",{src:this.authorImage}):""),i("div",{class:"content"},i("a",{class:"author"},this.authorName),i("div",{class:"metadata"},i("span",{class:"published-date"},this.publishedDate)),i("div",{class:"text"},this.description),i("div",{class:"actions"},this.allowReply?i("a",{class:"reply"},"Reply"):"",this.allowDelete?i("a",{class:"delete",onClick:t=>this.deleteAnnotation(t)},"Delete"):""))))}};m.style=":host{display:block}.comment{position:relative;background:0 0;margin:.5em 0 0;padding:.5em 0 0;border:none;border-top:none;line-height:1.2}.avatar{display:block;width:2.5em;height:2.5em;float:left;margin:.2em 0 0}.avatar img{display:block;margin:0 auto;width:100%;height:100%;border-radius:.25rem}.author{font-weight:600}.metadata{display:inline-block;margin-left:.5em;color:rgba(0,0,0,.4);font-size:.875em}.metadata>*{display:inline-block;margin:0 .5em 0 0}.content{margin-left:3.5em}.text{margin:.25em 0 .5em;font-size:1em;word-wrap:break-word;color:rgba(0,0,0,.87);line-height:1.3}.actions{font-size:.875em}.actions a{cursor:pointer;display:inline-block;margin:0 .75em 0 0;color:rgba(0,0,0,.4)}.actions a:hover{text-decoration:underline;color:rgba(0,0,0,0.8)}";let p=class{constructor(i){t(this,i),this.eventAddAnnotation=e(this,"eventAddAnnotation",7),this.placeholder="Join the discussion...",this.submit="Share comment",this.auth=null}async componentWillLoad(){this.session=a(),console.log("Session",this.session),void 0!==this.session&&(this.auth=n.deserialize(this.session),this.member=await r(JSON.parse(this.session).username,this.auth))}submitAnnotation(t){if(this.error=null,t.preventDefault(),0===this.inputEl.value.length)return;let e={content:this.inputEl.value,target:this.target,author:this.member.username,createdDate:new Date};this.commitAnnotation(e)}clearAnnotation(){this.inputEl.value=""}async commitAnnotation(t){let e={attributes:Object.assign({target:t.target,description:t.content,created_at:t.createdDate.getTime(),updated_at:t.createdDate.getTime()},t),geometry:t.geometry},i=await(s={url:this.annotationsUrl,features:[e],authentication:this.auth},s.features&&s.features.length&&s.features.forEach((t=>{var e;(e=t).attributes=Object.assign(Object.assign({},{status:"pending",source:"hub.js"}),e.attributes)})),function(t){var e=c(t.url)+"/addFeatures",i=d(t,["features","gdbVersion","returnEditMoment","rollbackOnFailure"],{params:h({},t.params)});return l(e,i)}(s).then((t=>Object.assign(Object.assign({},t),{addResults:o(t.addResults)}))));var s;i&&i.addResults[0].success?(this.eventAddAnnotation.emit({newAnnotation:t}),this.clearAnnotation()):(this.errorEl.active=!0,this.error=i.addResults[0].error.description)}render(){return i(s,null,i("slot",null),i("div",{class:"annotation-entry"},i("textarea",{placeholder:this.placeholder,ref:t=>this.inputEl=t}),i("br",null),i("calcite-button",{onClick:t=>this.submitAnnotation(t)},this.submit),i("calcite-alert",{label:"alert",ref:t=>this.errorEl=t,autoDismiss:!0,color:"red",scale:"s"},i("div",{slot:"alert-title"},"There was a problem adding your comment."),i("div",{slot:"alert-message"},this.error))))}};p.style=":host{display:block}.annotation-entry textarea{background:rgba(0, 0, 0, 0) none repeat scroll 0 0;color:#4c4c4c;font-size:1em;min-height:3em;width:80%;padding-left:5px}calcite-button{height:3em}";export{m as discussion_entry,p as discussion_input}