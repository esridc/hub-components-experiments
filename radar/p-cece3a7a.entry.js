import{r as e,h as t,H as i}from"./p-d703c309.js";import{r as a}from"./p-0050330c.js";import{U as r}from"./p-82285f77.js";import"./p-ae8fd155.js";const s="https://geoenrich.arcgis.com/arcgis/rest/services/World/geoenrichmentserver",c="/StandardGeographyQuery/execute?f=pjson&";let l=class{constructor(t){e(this,t),this.location="",this.uistepper=!1,this.locationSuggestions=[],this.locationList=[],this.value=[],this.locations=[],this.auth=null}async componentWillLoad(){this.session=a(),this.session&&(this.auth=r.deserialize(this.session))}async searchInputHandler(e){if(this.location=e.target.value,this.auth){console.log("Geography-Picker: Searching...",[this.checkMapSearch.checked,this.mapElement.mapExtent]);let e=this.checkMapSearch.checked?this.mapElement.mapExtent:null,t=await async function(e,t,i){const a={featureLimit:10,sourceCountry:"US",useFuzzySearch:!0,geographylayers:["US.States","US.Counties","US.Places","cities"],geographyQuery:e,token:i};t&&(a.spatialfilter=JSON.stringify({AnalysisExtent:{extent:t}}));const r=Object.keys(a).map((e=>e+"="+a[e])).join("&");let l=await fetch([s,c,r].join(""),{});return(await l.json()).results[0].value.features}(this.location,e,this.auth.token);console.log("Geography-Picker: SearchLocations Results",t),this.locationSuggestions=[];let i=[];t.forEach((e=>{this.locationSuggestions.push(`${e.attributes.DataLayerID}: ${e.attributes.AreaName}, ${e.attributes.MajorSubdivisionName}`),i.push(e.attributes)})),this.locationList=i}else console.error("Geography-Picker: Sign-in required for geography picker");return"true"}async selectLocation(e,t){let i=await async function(e,t,i){let a={featureLimit:10,sourceCountry:"US",generalizationLevel:6,geographylayers:[t],geographyids:[e],returnGeometry:!0,token:i};const r=Object.keys(a).map((e=>e+"="+a[e])).join("&"),l=await fetch([s,c,r].join(""),{});return(await l.json()).results[0].value.features}(e,t,this.auth.token);this.locations=[i[0]]}showModal(){this.pickerModal.active=!0}renderMap(){return t("div",{class:"picker-grid"},t("div",{class:"picker-search"},t("calcite-input",{scale:"m",placeholder:"Search for locations...",onInput:e=>this.searchInputHandler(e)}),t("calcite-checkbox",{ref:e=>this.checkMapSearch=e,checked:!0,scale:"m"},"Search within map area")),t("div",{class:"picker-list"},this.locationList.length>0?t("h3",null,"Pick a Boundary"):"",this.locationList.map((e=>t("div",{class:"location-result"},t("calcite-tile-select",{onClick:()=>this.selectLocation(e.AreaID,e.DataLayerID),description:`${e.MajorSubdivisionName}, ${e.CountryAbbr} \n ${e.DataLayerID}`,heading:e.AreaName,name:"geography-demo","show-input":"left","input-alignment":"end",type:"radio",width:"auto"}))))),t("div",{class:"picker-map places-map"},t("hub-map",{ref:e=>this.mapElement=e,class:"places-hub-map",center:"[-77,38.8]",zoom:10,drawing:!0,geometry:this.locations.map((e=>e.geometry))})))}renderEdit(){return t("div",{class:"picker-grid"},t("div",{class:"picker-list"},t("calcite-input",null)),t("div",{class:"picker-map places-map"},t("hub-map",{ref:e=>this.mapElement=e,class:"places-hub-map",center:"[-77,38.8]",zoom:10,drawing:!0,geometry:this.locations.map((e=>e.geometry))})))}renderStepper(e){return t("calcite-stepper",{numbered:!0},t("calcite-stepper-item",{"item-title":"Choose Boundary","item-subtitle":"..."},e),t("calcite-stepper-item",{"item-title":"Edit & Confirm","item-subtitle":"..."},"maybe edit it now!",e))}renderModal(){return t("calcite-modal",{ref:e=>this.pickerModal=e,"aria-labelledby":"modal-title",scale:"m",width:"m"},t("h3",{slot:"header",id:"modal-title"},"Choose a Boundary"),t("div",{slot:"content"},this.renderStepper(this.renderMap())),t("calcite-button",{slot:"secondary",width:"full",appearance:"outline"},"Cancel"),t("calcite-button",{slot:"primary",width:"full"},"Select Boundary"))}render(){return t(i,null,t("slot",null),this.uistepper?this.renderStepper(this.renderMap()):this.renderMap())}};l.style=':host{display:block}.picker-grid{height:500px;display:grid;grid-template-columns:30% 70%;grid-template-rows:50px 600px;grid-template-areas:"search map"\n    "list map";column-gap:10px;row-gap:10px;padding:0 1rem 0 3rem}.picker-search{grid-area:search}.picker-map{grid-area:map}.picker-list{grid-area:list;max-height:400px;overflow:auto}hub-map,.places-map{height:600px}.location-result{padding-left:5px;cursor:pointer}calcite-tile-select{width:100%}';export{l as hub_geography_picker}