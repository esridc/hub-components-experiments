import{r as t,h as i}from"./p-d703c309.js";import{a as e}from"./p-0050330c.js";import{g as r}from"./p-797f9b51.js";import{b as n,u as s}from"./p-937fb610.js";import{g as o,a}from"./p-6343e8b1.js";import{g as c}from"./p-fae24807.js";import{r as u}from"./p-ae8fd155.js";import{g as p}from"./p-a8ccf5d0.js";import{j as m,l}from"./p-2f73c2e8.js";import{U as h}from"./p-82285f77.js";function f(t){return p(t)+"/community/users/"+encodeURIComponent(t.username)}function d(t,i,e,r){let n=`${e||"https://www.arcgis.com/sharing/rest"}/content/items/${t}/resources`;return n=r?`${n}/${r}/${i}`:`${n}/${i}`,n}const g=function(t){return{id:t.id,name:t.field.name,alias:t.field.alias,type:t.field.type}},w=function(t){return{type:"Feature Layer",url:t.url,itemId:t.itemId,layerId:t.layerId,name:t.name||t.id,mappings:t.fields.map(g)}},y=function(t){return{id:t.id,type:"Data",name:t.name||t.id,definition:{description:t.name||t.id},source:w(t)}};function v(t){return t.id}function I(t){if(r(t,"item.properties.schemaVersion")<2){const r=n(t);return r.item.properties.schemaVersion=2,r.data.steps=(e=r.data.values,(i=r.data.values.steps)&&Array.isArray(i)?i.map((t=>function(t){const i=t.items||[];return{title:t.title,description:t.description,id:t.id,templateIds:(t.templates||[]).map(v),itemIds:i.map(v)}}(e[t]))):[]),r.data.values.steps&&(r.data.values.steps.forEach((t=>{delete r.data.values[t]})),delete r.data.values.steps),r.data.indicators=function(t){return Object.keys(t).reduce(((i,e)=>{const r=t[e];if(function(t){let i=!1;return Array.isArray(t.fields)&&t.fields.length>0&&(i=!0),i}(r)){const t=n(r);t.id=e,i.push(t)}return i}),[])}(r.data.values).map(y),r}var i,e;return t}function b(t,i){return 2.2===r(t,"item.properties.schemaVersion")?t:t=function(t){const i=n(t),e=function(t){let i=[];return Array.isArray(t)&&(i=t.reduce(((t,i)=>r(i,"templateIds.length")?t.concat(i.templateIds):t),[])),i}(r(i,"data.steps")),s=r(i,"data.recommendedTemplates")||[],o=e.concat(s);return i.data.recommendedTemplates=o.reduce(((t,i)=>(t.indexOf(i)<0&&t.push(i),t)),[]),i}(t=function(t){if(r(t,"item.properties.schemaVersion")<2.1){const i=n(t);i.item.properties.schemaVersion=2.1;const e=r(t,"item.properties.groupId");return e&&(i.item.properties.collaborationGroupId=e,delete i.item.properties.groupId),i}return t}(t=I(t=function(t,i){if(r(t,"item.properties.schemaVersion")<1.1){const e=n(t);return e.item.properties.schemaVersion=1.1,function(t,i){t.data.assets||(t.data.assets=[{id:"bannerImage",url:d(t.item.id,"detail-image.jpg",i),properties:{type:"resource",fileName:"detail-image.jpg",mimeType:"image/jepg"},license:{type:"none"}},{id:"iconDark",url:d(t.item.id,"icon-dark.png",i),properties:{type:"resource",fileName:"icon-dark.png",mimeType:"image/png"},license:{type:"none"}},{id:"iconLight",url:d(t.item.id,"icon-light.png",i),properties:{type:"resource",fileName:"icon-light.png",mimeType:"image/png"},license:{type:"none"}}])}(e,i),e.data.values.bannerImage||(e.data.values.bannerImage={source:"bannerImage",display:{position:{x:"50%",y:"10%"}}}),e}return t}(t=function(t){const i=r(t,"item.properties.schemaVersion");if(!i||i<1){const i=n(t);i.data.values||(i.data.values={}),i.item.properties||(i.item.properties={}),i.item.properties.schemaVersion=1;let e=!1;if(i.item.typeKeywords&&(e=i.item.typeKeywords.indexOf("hubInitiativeTemplate")>=0),!!i.data.source&&i.item.properties.source!==i.data.source&&(i.item.properties.source=i.data.source),i.data.configurationSettings){const t=n(i.data.configurationSettings);delete i.data.configurationSettings;const r=t.find((t=>"Steps"===t.category));i.data.values.steps=r.fields.map((t=>t.fieldName)),r.fields.forEach((t=>{i.data.values[t.fieldName]||(i.data.values[t.fieldName]={}),i.data.values[t.fieldName].title=t.label,i.data.values[t.fieldName].description=t.tooltip,i.data.values[t.fieldName].id=t.fieldName,i.data.values[t.fieldName].items?e&&(i.data.values[t.fieldName].templates=i.data.values[t.fieldName].items,delete i.data.values[t.fieldName].items):(i.data.values[t.fieldName].items=[],i.data.values[t.fieldName].templates=[])}))}return i}return t}(t),i))))}function j(t,i){return Promise.all([o(t,i),a(t,i)]).then((t=>({item:t[0],data:t[1]}))).then((t=>b(t,c(i))))}const $=t=>`hubInitiativeId|${t}`,x=t=>t.replace(/^hubInitiativeId\|/,""),N=t=>t.replace(/^hubInitiativeFollowers\|/,""),O=t=>`${f(t)}/update`,P=t=>t.groups.map((t=>t.tags)).reduce(((t,i)=>t.concat(i)),[]).filter((t=>0===t.indexOf("hubInitiativeFollowers|"))).map(N),F=(t,i)=>(t=>[...(t=>t.tags.map(x))(t),...P(t)].filter(s))(t).indexOf(i)>-1;let S=class{constructor(n){t(this,n),this.icon=i("svg",{class:"follow-icon",viewBox:"0 0 120 120",width:"100%",height:"100%"},i("circle",{cx:"18.385",cy:"101.615",r:"18.385"}),i("path",{d:"M-1.031 61c32.533 0 59 26.468 59 59s-26.467 59-59 59-59-26.468-59-59 26.467-59 59-59m0-23c-45.288 0-82 36.713-82 82s36.712 82 82 82 82-36.713 82-82-36.712-82-82-82z"}),i("path",{d:"M.154 23.041c53.349 0 96.75 43.402 96.75 96.75s-43.402 96.75-96.75 96.75-96.75-43.402-96.75-96.75 43.402-96.75 96.75-96.75m0-23c-66.136 0-119.75 53.615-119.75 119.75s53.614 119.75 119.75 119.75c66.135 0 119.75-53.615 119.75-119.75S66.289.041.154.041z"})),this.orgurl="https://www.arcgis.com",this.following=!1,this.followtext="Follow Our Initiative",this.unfollowtext="Unfollow Our Initiative",this.callToActionText=this.followtext,this.triggerFollow=()=>e(this.clientid,this.orgurl).then((t=>(this.session=t,this.toggleFollow()))),this.toggleFollow=()=>{return console.log("toggleFollow",this.following),this.following?function(t){return u(f(t.authentication),{authentication:t.authentication}).then((i=>F(i,t.initiativeId)?i:Promise.reject("user is not following this initiative."))).then((i=>{const e=$(t.initiativeId),r=JSON.parse(JSON.stringify(i.tags));if(r.indexOf(e)>-1){const n=r.indexOf(e);return r.splice(n,1),0===r.length&&r.push(","),u(O(t.authentication),{params:{tags:r},authentication:t.authentication}).then((()=>i))}return i})).then((i=>j(t.initiativeId,t).then((t=>({user:i,initiative:t}))))).then((i=>{const e=r(i,"initiative.item.properties.followersGroupId");return e&&P(i.user).indexOf(t.initiativeId)>-1?l({id:e,authentication:t.authentication}).then((()=>({success:!0,username:i.user.username}))):{success:!0,username:i.user.username}}))}({initiativeId:this.initiativeid,authentication:h.deserialize(this.session)}).then((t=>{if(t.success)return Promise.resolve()})).catch((t=>{if("user is not following this initiative."===t)return Promise.resolve()})).then((()=>(this.callToActionText=this.unfollowtext,this.following=!1,{success:!0}))):(t={initiativeId:this.initiativeid,authentication:h.deserialize(this.session)},u(f(t.authentication),{authentication:t.authentication}).then((i=>F(i,t.initiativeId)?Promise.reject("user is already following this initiative."):i)).then((i=>j(t.initiativeId,t).then((t=>({user:i,initiative:t,hasFollowersGroup:!1}))))).then((i=>{const e=r(i,"initiative.item.properties.followersGroupId");return e?m({id:e,authentication:t.authentication}).then((t=>(i.hasFollowersGroup=t.success,i))):i})).then((i=>{if(!i.hasFollowersGroup){const e=$(t.initiativeId),r=JSON.parse(JSON.stringify(i.user.tags));return r.push(e),u(O(t.authentication),{params:{tags:r},authentication:t.authentication})}return{success:!0,username:i.user.username}}))).then((t=>{if(t.success)return Promise.resolve(t)})).catch((t=>{if("user is already following this initiative."===t)return Promise.resolve()})).then((()=>(this.callToActionText=this.followtext,this.following=!0,{success:!0})));var t}}render(){return i("hub-button",{text:this.callToActionText,action:this.triggerFollow,icon:this.icon})}};S.style=".follow-icon{height:15px;width:15px;vertical-align:baseline;padding-right:5px;fill:currentColor}";export{S as hub_follow_button}