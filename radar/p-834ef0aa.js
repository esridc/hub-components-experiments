import{_ as t,a as o}from"./p-8dae81d7.js";import{g as e,s as r}from"./p-46d9ff3a.js";import{c as n,f as s}from"./p-90bbd14a.js";import{g as a}from"./p-797f9b51.js";function i(t){return e(t,"group")}function c(t){return e(t,"groupContent")}function u(t){const o=function(t={}){return Object.keys(t).map((o=>{const e=t[o],{fn:r,terms:n}=e,s=encodeURIComponent(`${e.catalogDefinition?"catalog":"filter"}[${o}]`),a=n.map(encodeURIComponent).join(",");return r?`${s}=${r}(${a})`:`${s}=${a}`})).join("&")}(n(t)),e=Object.keys(t).filter((t=>{return!(s[o=t]&&"filter"===s[o].type);var o})),r={};e.forEach((o=>{r[o]=t[o]}));const i=function(t={}){const o=function(t={}){const o=[],e=[{obj:t,path:[]}];for(;e.length>0;){const t=e.pop();Object.keys(t.obj).forEach((r=>{if("object"==typeof t.obj[r]){const n=t.path.concat(r);o.push(n),e.unshift({obj:t.obj[r],path:n})}else o.push(t.path.concat(r))}))}return o}(t).filter((o=>"object"!=typeof a(t,o.join(".")))),e=[];return o.forEach((o=>{let r="";for(let t=0;t<o.length;t++)r+=0===t?o[t]:`[${o[t]}]`;const n=encodeURIComponent(a(t,o.join("."))||""),s=encodeURIComponent(r);return n&&e.push(`${s}=${n}`),r})),e.join("&")}(r),c=[];return i&&c.push(i),o&&c.push(o),c.join("&")}async function l(e,n){return console.log("hub-search search: queryParams",[e,n]),void 0===n||void 0!==n&&n.isPortal?await async function(o,e){var n;console.log("searchPortal",[o,e]),o.sort=(o.sort||"modified").replace(/name/,"title");let s=[];void 0!==o.q&&0!==(null===(n=o.q)||void 0===n?void 0:n.length)||(o.q="*"),s.push(o.q),o.owner&&s.push(`owner:${o.owner}`);let a=o.sort,i=o.order||"asc",u=o.sort.match(/^-/);if(null!==u&&(a=u[1],i="desc"),void 0!==o.customParams&&void 0!==o.customParams.group)return c({groupId:o.customParams.group.id,q:s.join(" AND "),num:o.limit||"10",sortField:a,sortOrder:i,params:{categories:o.customParams.group.categories}}).then((o=>new Promise((e=>{e({results:o.results.map((o=>t({item:o})))})}))));if(void 0!==o.groups&&o.groups.length>0){const t=o.groups.map((t=>`group:${t}`)).join(" OR ");s.push(`(${t})`)}return console.debug("hub-search searchPortal: queryParams",[o,e]),r({q:s.join(" AND "),num:o.limit||"10",sortField:a,sortOrder:i,authentication:null==e?void 0:e.authentication}).then((o=>new Promise((e=>{e({results:o.results.map((o=>t({item:o}))),meta:{total:o.total,count:o.num,start:o.start}})}))))}(e,n):await async function(t,e){t.sort=(t.sort||"modified").replace(/title/,"name");const r={q:t.q,sort:t.sort,agg:{fields:"tags,collection,owner,source,hasApi,downloadable",size:t.limit}};r.page={key:btoa(JSON.stringify({hub:{start:1,size:t.limit},ago:{start:1,size:t.limit}}))},void 0!==t.groups&&t.groups.length>0&&(r.groupIds=t.groups.join(","));const n=u(r);let s=await fetch(`${e.hubApiUrl}/api/v3/search?${n}`,{});return{results:(await s.json()).data.map(o)}}(e,n)}export{l as a,i as b,c as s}