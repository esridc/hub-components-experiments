import{r as t,c as e,h as s,g as i}from"./p-d703c309.js";import{g as r,b as a,c as n,d as o}from"./p-9a3108ff.js";import{r as d}from"./p-0050330c.js";import{U as h}from"./p-82285f77.js";import{r as l,c,_ as p}from"./p-ae8fd155.js";import{a as u}from"./p-a8ccf5d0.js";import"./p-8dae81d7.js";import"./p-6343e8b1.js";import"./p-6bdf64e1.js";import"./p-834ef0aa.js";import"./p-46d9ff3a.js";import"./p-90bbd14a.js";import"./p-797f9b51.js";import"./p-7c13aa15.js";import"./p-4b2e8de5.js";import"./p-fae24807.js";function g(t){return function(t){var e=c(t.url)+"/deleteFeatures",s=u(t,["where","objectIds","gdbVersion","returnEditMoment","rollbackOnFailure"],{params:p({},t.params)});return l(e,s)}(t)}let m=class{constructor(s){t(this,s),this.newResponse=e(this,"newResponse",7),this.allowReply=!0,this.auth=null,this.portalUrl="https://www.arcgis.com",this.authors={},this.searchOptions={}}eventAddAnnotation(t){console.log("Event: eventAddAnnotation",t),this.addAnnotation(t.detail.annotation)}addAnnotation(t){this.updateAnnotations(),this.newResponse.emit(t)}queryUpdated(){this.updateAnnotations()}targetUpdated(t){console.log("hub-discussion: Updated discussion target",t),this.updateAnnotations()}componentWillLoad(){return this.session=d(),this.session&&(this.auth=h.deserialize(this.session),this.username=JSON.parse(this.session).username),null==this.target?this.target="":this.searchOptions.target=this.target,r(this.org).then((t=>(this.annotationsUrl=t+"/0",this.updateAnnotations())))}updateAnnotations(){return this.getAnnotations().then((t=>{this.annotations=t.data;for(let e=0;e<t.included.length;e++)void 0===this.authors[t.included[e].id]&&(this.authors[t.included[e].id]=t.included[e].attributes)}))}deleteAnnotation(t){console.log("deleteAnnotations",t),g({url:this.annotationsUrl,objectIds:[t]}).then((t=>(console.log("deleteAnnotations",t),this.updateAnnotations())))}getAnnotations(){let t=["1=1"];return this.query&&t.push(`description LIKE '%${this.query}%'`),this.target&&t.push(`target LIKE '${this.target}'`),a({url:this.annotationsUrl,where:t.join(" AND ")})}searchChanged(t){return this.query=t.target.value,this.updateAnnotations()}getElementById(t){for(let e=0;e<this.el.childElementCount;e++)if(this.el.children[e].getAttribute("id")==t)return this.el.children[e];return null}async removeAnnotation(t){console.log("removeAnnotation",[t.target.id,t]);const e=t.detail;let s=await g({url:this.annotationsUrl,objectIds:[e],authentication:this.auth});console.debug("hub-discussion: removeAnnotation response",s),this.updateAnnotations()}getAuthor(t){return console.log("getAuthor 1",[t,this.authors[t]]),0===t.length?this.authors[t]||n():(console.log("getAuthor 2",[t,o(this.authors[t])]),o(this.authors[t]))}formatDate(t){return new Date(t).toLocaleString()}discussionCard(t){return s("calcite-card",{class:"gallery-card",selectable:!0},s("img",{class:"card-image",slot:"thumbnail"}),s("h3",{slot:"title"},s("img",{src:this.getAuthor(t.attributes.Creator).thumbnailUrl}),this.getAuthor(t.attributes.Creator).name),s("span",{slot:"subtitle"}),t.attributes.description,s("span",{slot:"footer-leading"},this.formatDate(t.attributes.created_at)))}renderGallery(){let t=[];return this.annotations.map((e=>{t.push(this.discussionCard(e))})),s("div",{class:"search-results gallery-lg "},t)}renderList(){let t=[],e=this.getElementById("annotation-header");var i="Comments";return null!==e&&(i=e.innerHTML),t.push(s("div",{class:"headind_srch"},s("div",{class:"recent_heading"},s("h4",{innerHTML:i})),s("div",{class:"srch_bar"},s("div",{class:"stylish-input-group"},s("input",{type:"text",class:"search-bar",placeholder:"Search",onChange:t=>this.searchChanged(t)}),s("span",{class:"input-group-addon"},s("button",{type:"button"}," ",s("i",{class:"fa fa-search","aria-hidden":"true"})," ")))))),t.push(s("div",{class:"discussion-list"},this.annotations.map((t=>s("discussion-entry",{annotationId:t.attributes.OBJECTID,authorImage:this.getAuthor(t.attributes.Creator).thumbnailUrl,authorName:this.getAuthor(t.attributes.Creator).name,description:t.attributes.description,publishedDate:this.formatDate(t.attributes.created_at),allowReply:this.allowReply&&t.attributes.Creator!==this.username,allowDelete:t.attributes.Creator===this.username,allowEdit:t.attributes.Creator===this.username}))))),this.username&&t.push(s("discussion-input",{target:this.target,annotationsUrl:this.annotationsUrl})),t}render(){return this.renderList()}get el(){return i(this)}static get watchers(){return{query:["queryUpdated"],target:["targetUpdated"]}}};m.style=':host{display:block}@media screen and (max-width: 530px){.gallery-card{width:calc((100% - (0 * 30px))/ 1)}}@media screen and (min-width: 530px) and (max-width: 975px){.gallery-card{width:calc((100% - (1 * 30px))/ 2)}}@media screen and (min-width: 975px) and (max-width: 1200px){.gallery-card{width:calc((100% - (2 * 30px))/ 3)}}@media screen and (min-width:1200px){.gallery-card{width:calc((100% - (3 * 30px))/ 4)}}.gallery-card{display:flex;flex-flow:column;color:#4c4c4c;flex-wrap:wrap;margin-bottom:30px;box-shadow:0 0 5px 0 rgba(76,76,76,.25);}.card-image{height:40px;background-image:url(https://idee.paris.fr/svg/preview-proposal-image.svg);background-size:cover;background-repeat:no-repeat;background-position:center center}.search-grid{display:grid;grid-template:".   search" auto\n    "filters results" auto /\n    12rem 3fr;padding:0 1rem 0 3rem}hub-suggest-input{grid-area:search}.filters{grid-area:filters}.search-results{grid-area:results;display:flex;flex-wrap:wrap;justify-content:space-between}.recent_heading{float:left;width:40%}.srch_bar{display:inline-block;text-align:right;width:60%}.headind_srch{padding:10px 29px 10px 20px;overflow:hidden;border-bottom:1px solid #c4c4c4}.recent_heading h4{color:#05728f;font-size:21px;margin:auto}.srch_bar input{border:1px solid #cdcdcd;border-width:0 0 1px 0;width:80%;padding:2px 0 4px 6px;background:none}.srch_bar .input-group-addon button{background:rgba(0, 0, 0, 0) none repeat scroll 0 0;border:medium none;padding:0;color:#707070;font-size:18px}.srch_bar .input-group-addon{margin:0 0 0 -27px}';export{m as hub_discussion}