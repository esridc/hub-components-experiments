import{r as t,_ as e,c as r}from"./p-ae8fd155.js";import{g as s,a as n}from"./p-a8ccf5d0.js";import{s as a}from"./p-46d9ff3a.js";import{g as i}from"./p-fae24807.js";function o(r,n){var a=r||"self",i=s(n)+"/portals/"+a,o=e({httpMethod:"GET"},n);return t(i,o)}function u(t,e){return function(t,e){return a(Object.assign({q:`typekeywords:hubEventsLayer AND orgid:${t}`},e)).then((t=>{if(t.results&&t.results.length>0){let e;if(1===t.results.length)e=t.results[0];else if(t.results.length>1){const r=t.results.reduce(((t,e)=>(e.typeKeywords.includes("View Service")?"public"===e.access?t.public=e:t.org=e:t.admin=e,t)),{});e=r.admin||r.org||r.public}return e}throw Error("No events service found. Events are likely not enabled.")}))}(t,e).then((r=>{const s=(n=e)&&n.hubApiUrl||function(t){let e;return t.match(/(qaext|\.mapsqa)\.arcgis.com/)?e="https://hubqa.arcgis.com":t.match(/(devext|\.mapsdevext)\.arcgis.com/)?e="https://hubdev.arcgis.com":t.match(/(www|\.maps)\.arcgis.com/)&&(e="https://hub.arcgis.com"),e}(i(n));var n;const a=r.url.match(/services\/(.*?)\/FeatureServer/);if(a[1])return`${s}/api/v3/events/${t}/${a[1]}/FeatureServer/0`}))}function c(t,e){let r;const s=Object.assign({},e);if("cancelled"===t)e.orderByFields||(s.orderByFields="EditDate DESC"),r="isCancelled=1 AND status<>'draft'";else if("draft"===t){e.orderByFields||(s.orderByFields="EditDate DESC");const t=e.authentication;r=`Creator = '${t?t.username:null}' AND status = 'draft'`}else e.orderByFields||(s.orderByFields="upcoming"===t?"startDate ASC":"startDate DESC"),r=`endDate${"upcoming"===t?">":"<="}CURRENT_TIMESTAMP AND (isCancelled<>1 OR isCancelled IS NULL) AND status<>'draft'`;return s.where=e.where?`${e.where} AND ${r}`:r,s}function l(s){var a=n(s,["where","objectIds","relationParam","time","distance","units","outFields","geometry","geometryType","spatialRel","returnGeometry","maxAllowableOffset","geometryPrecision","inSR","outSR","gdbVersion","returnDistinctValues","returnIdsOnly","returnCountOnly","returnExtentOnly","orderByFields","groupByFieldsForStatistics","outStatistics","returnZ","returnM","multipatchOption","resultOffset","resultRecordCount","quantizationParameters","returnCentroid","resultType","historicMoment","returnTrueCurves","sqlFormat","returnExceededLimitFeatures","f"],{httpMethod:"GET",params:e({where:"1=1",outFields:"*"},s.params)});return t(r(s.url)+"/query",a)}function d(t){const e=Object.assign({returnGeometry:!0},t);return l(e).then((r=>r.features.length<=0?{data:[],included:[]}:e.authentication?e.authentication.getToken(e.url).then((s=>f(r.features,e.url,t,s))):f(r.features,e.url,t)))}function f(t,e,r,s){const n=[],i=[],o=[],u=(new Date).getTime();let c="";if(t.forEach((function(t){const r=t.attributes,a=t.geometry;let o=null;if(r.imageAttributes){const t=JSON.parse(r.imageAttributes);t.crop&&(o=`${e}/${r.OBJECTID}/attachments/${t.crop}?v=${u}`,s&&(o+=`&token=${s}`))}i.push({id:r.OBJECTID,type:"events",imageUrl:o,attributes:r,geometry:a});const l=r.siteId;null!=l&&-1===n.indexOf(l)&&(n.push(l),c+=c.length>0?" OR id:":"id:",c+=l)})),0===n.length)return{included:o,data:i};const l=r;return l.q=c,a(l).then((function(t){return t.results.forEach((t=>{o.push({id:t.id,type:"sites",attributes:{id:t.id,url:t.url}})})),{included:o,data:i}}))}export{c as a,u as b,o as g,l as q,d as s}